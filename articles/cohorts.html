<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cohort tables • omopgenerics</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cohort tables">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">omopgenerics</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Classes</h6></li>
    <li><a class="dropdown-item" href="../articles/cdm_reference.html">The cdm reference</a></li>
    <li><a class="dropdown-item" href="../articles/codelists.html">Concept sets</a></li>
    <li><a class="dropdown-item" href="../articles/cohorts.html">Cohort tables</a></li>
    <li><a class="dropdown-item" href="../articles/summarised_result.html">A summarised result</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Principles</h6></li>
    <li><a class="dropdown-item" href="../articles/reexport.html">Re-exporting functions from omopgnerics</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cohort tables</h1>
            
      

      <div class="d-none name"><code>cohorts.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="cohort-table">Cohort table<a class="anchor" aria-label="anchor" href="#cohort-table"></a>
</h2>
<p>A cohort is a <strong>set of people that fulfill a certain set of
criteria for a period of time</strong>.</p>
<p>In omopgenerics we defined the <code>cohort_table</code> class that
allows us to represent individuals in a cohort.</p>
<p>A <code>cohort_table</code> is created using the
<code><a href="../reference/newCohortTable.html">newCohortTable()</a></code> function that is defined by:</p>
<ul>
<li><p>A cohort table.</p></li>
<li><p>A cohort set.</p></li>
<li><p>A cohort attrition.</p></li>
</ul>
<p>Let’s start by creating a cdm reference with just two people.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">person</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  person_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>  gender_concept_id <span class="op">=</span> <span class="fl">0</span>, year_of_birth <span class="op">=</span> <span class="fl">1990</span>,</span>
<span>  race_concept_id <span class="op">=</span> <span class="fl">0</span>, ethnicity_concept_id <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="va">observation_period</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  observation_period_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, person_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>  observation_period_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>,</span>
<span>  observation_period_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-12-31"</span><span class="op">)</span>,</span>
<span>  period_type_concept_id <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cdmFromTables.html">cdmFromTables</a></span><span class="op">(</span></span>
<span>  tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"person"</span> <span class="op">=</span> <span class="va">person</span>,</span>
<span>    <span class="st">"observation_period"</span> <span class="op">=</span> <span class="va">observation_period</span></span>
<span>  <span class="op">)</span>,</span>
<span>  cdmName <span class="op">=</span> <span class="st">"example_cdm"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 5 column in <span style="font-weight: bold;">person</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `person_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `gender_concept_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `year_of_birth` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `race_concept_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `ethnicity_concept_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 3 column in <span style="font-weight: bold;">observation_period</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `observation_period_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `person_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `period_type_concept_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;"># OMOP CDM reference (local) of example_cdm</span> <span style="color: #00BBBB;">─────────────────────────────────</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">omop tables:</span> person, observation_period</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">cohort tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">achilles tables:</span> -</span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other tables:</span> -</span></span></code></pre></div>
<p>Now let’s say one of these people have a clinical event of interest,
we can include them in a cohort table which can then be used as part of
an analysis.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  cohort_definition_id <span class="op">=</span> <span class="fl">1</span>, subject_id <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cohort_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>,</span>
<span>  cohort_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-10"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/insertTable.html">insertTable</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"cohort"</span>, table <span class="op">=</span> <span class="va">cohort</span><span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCohortTable.html">newCohortTable</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 2 column in <span style="font-weight: bold;">cohort</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `subject_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span></code></pre></div>
<p>The cohort table will be associated with settings and attrition. As
we didn’t specify these in newCohortTable() above they will have been
automatically populated. You can access the cohort set of a cohort table
using the function <code><a href="../reference/settings.html">settings()</a></code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/settings.html">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 cohort_1</span></span></code></pre></div>
<p>Meanwhile, you can access the cohort attrition of a cohort table
using the function <code><a href="../reference/attrition.html">attrition()</a></code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/attrition.html">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              1               1         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span></code></pre></div>
<p>Cohort attrition table is also used to compute the number of counts
that each cohort (ie from the last row of the attrition). It can be seen
with the function <code><a href="../reference/cohortCount.html">cohortCount()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cohortCount.html">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              1               1</span></span></code></pre></div>
<p>Note that because the cohort count is taken from the last row of
attrition, if we make changes to a cohort we should then update
attrition as we go. We can do this</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort_start_date</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-01-01"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"cohort"</span>, temporary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/recordCohortAttrition.html">recordCohortAttrition</a></span><span class="op">(</span><span class="st">"Require cohort start January 1st 2019"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 1 casted column in <span style="font-weight: bold;">cohort (cohort_attrition)</span> as do not match expected column</span></span>
<span><span class="co">#&gt;   type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` from <span style="color: #0000BB;">numeric</span> to <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 2 column in <span style="font-weight: bold;">cohort</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `subject_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="fu"><a href="../reference/attrition.html">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              1               1         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    1              0               0         2 Require cohort …</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span>
<span><span class="fu"><a href="../reference/cohortCount.html">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              0               0</span></span></code></pre></div>
<p>An additional, optional, attribute keeps track of the concepts used
to create the cohort. In this example we do not have a codelist
associated with our cohort.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cohortCodelist.html">cohortCodelist</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span>, cohortId <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"index event"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: No codelists found for the specified cohorts</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">0 codelists</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span></code></pre></div>
<p>We could though associate our cohort with a codelist</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCohortTable.html">newCohortTable</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span>, </span>
<span>                             cohortCodelistRef <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>                                 cohort_definition_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>                                 codelist_name <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease X"</span>, <span class="st">"disease X"</span><span class="op">)</span>,</span>
<span>                                 concept_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">101</span>,<span class="fl">102</span><span class="op">)</span>,</span>
<span>                                 type <span class="op">=</span> <span class="st">"index event"</span></span>
<span>                               <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 2 casted column in <span style="font-weight: bold;">cohort (cohort_codelist)</span> as do not match expected column</span></span>
<span><span class="co">#&gt;   type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` from <span style="color: #0000BB;">numeric</span> to <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `concept_id` from <span style="color: #0000BB;">numeric</span> to <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 2 column in <span style="font-weight: bold;">cohort</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `subject_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="fu"><a href="../reference/cohortCodelist.html">cohortCodelist</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort</span>, cohortId <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"index event"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">1 codelist</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; - disease X (2 codes)</span></span></code></pre></div>
<p>Each one of the elements that define a cohort table have to fulfill
certain criteria.</p>
<div class="section level3">
<h3 id="cohort-set">Cohort Set<a class="anchor" aria-label="anchor" href="#cohort-set"></a>
</h3>
<p>A cohort set must be a table with:</p>
<ul>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, cohort_name columns
(<code>cohortColumns("cohort_set")</code>).</p></li>
<li><p><code>cohort_name</code> it must contain unique cohort names
(currently they are cased to snake case).</p></li>
<li><p><code>cohort_definition_id</code> it must contain unique cohort
ids, all the ids present in table must be present in the cohort set and
the same ids must be present in cohort attrition.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="cohort-attrition">Cohort Attrition<a class="anchor" aria-label="anchor" href="#cohort-attrition"></a>
</h3>
<p>A cohort attrition must be a table with:</p>
<ul>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, number_records, number_subjects,
reason_id, reason, excluded_records, excluded_subjects columns
(<code>cohortColumns("cohort_attrition")</code>).</p></li>
<li><p><code>cohort_definition_id</code> it must contain cohort ids, all
the ids present in table must be present in the cohort attrition and the
same ids must be present in cohort set.</p></li>
<li><p>There must exist unique pairs of
<code>cohort_definition_id</code> and <code>reason_id</code>.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="cohort-codelist">Cohort Codelist<a class="anchor" aria-label="anchor" href="#cohort-codelist"></a>
</h3>
<p>A cohort codelist must be a table with:</p>
<ul>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, codelist_name, concept_id, type
columns (<code>cohortColumns("cohort_codelist")</code>).</p></li>
<li><p><code>cohort_definition_id</code> it must contain cohort ids, all
the ids present in table must be present in the cohort attrition and the
same ids must be present in cohort set.</p></li>
<li><p><code>type</code> must be one of “index event”, “inclusion
criteria”, and “exit criteria”</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="cohort-table-1">Cohort Table<a class="anchor" aria-label="anchor" href="#cohort-table-1"></a>
</h3>
<p>A cohort table must be a table with:</p>
<ul>
<li><p>It comes from a cdm_reference (extracted via
<code>cdm$cohort</code>).</p></li>
<li><p>It has the same source than this cdm_reference.</p></li>
<li><p>Lower case column names.</p></li>
<li><p>At least cohort_definition_id, subject_id, cohort_start_date,
cohort_end_date columns (<code>cohortColumns("cohort")</code>).</p></li>
<li><p>There is no record with <code>NA</code> value in the required
columns.</p></li>
<li><p>There is no record with <code>cohort_start_date</code> after
<code>cohort_end_date</code>.</p></li>
<li><p>There is no overlap between records. A person can be in a cohort
several times (several records with the same subject_id). But it can’t
enter (cohort_start_date) the cohort again before leaving it
(cohort_end_date). So an individual can’t be simultaneously more than
once in the same cohort. This rule is applied at the
cohort_definition_id level, so records with different
cohort_definition_id can overlap.</p></li>
<li><p>All the time between cohort_start_date and cohort_end_date (both
included) the individual must be in observation.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="combining-generated-cohort-sets">Combining generated cohort sets<a class="anchor" aria-label="anchor" href="#combining-generated-cohort-sets"></a>
</h2>
<p>You can bind two cohort tables using the method <code><a href="../reference/bind.html">bind()</a></code>.
You can combine several cohort tables using this method. The only
constrain is that cohort names must be unique across the different
cohort tables. You have to provide a name for the new cohort table.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">asthma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  cohort_definition_id <span class="op">=</span> <span class="fl">1</span>, subject_id <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cohort_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>,</span>
<span>  cohort_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-10"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/insertTable.html">insertTable</a></span><span class="op">(</span><span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"asthma"</span>, table <span class="op">=</span> <span class="va">asthma</span><span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">asthma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCohortTable.html">newCohortTable</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">asthma</span>, </span>
<span>                             cohortSetRef <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>cohort_definition_id <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                   cohort_name <span class="op">=</span> <span class="st">"asthma"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 1 casted column in <span style="font-weight: bold;">asthma (cohort_set)</span> as do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` from <span style="color: #0000BB;">numeric</span> to <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 2 column in <span style="font-weight: bold;">asthma</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `subject_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span></span>
<span><span class="va">copd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  cohort_definition_id <span class="op">=</span> <span class="fl">1</span>, subject_id <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  cohort_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-01"</span><span class="op">)</span>,</span>
<span>  cohort_end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-10"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/insertTable.html">insertTable</a></span><span class="op">(</span><span class="va">cdm</span>, name <span class="op">=</span> <span class="st">"copd"</span>, table <span class="op">=</span> <span class="va">copd</span><span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">copd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newCohortTable.html">newCohortTable</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">copd</span>, </span>
<span>                           cohortSetRef <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>cohort_definition_id <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                   cohort_name <span class="op">=</span> <span class="st">"copd"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 1 casted column in <span style="font-weight: bold;">copd (cohort_set)</span> as do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` from <span style="color: #0000BB;">numeric</span> to <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 2 column in <span style="font-weight: bold;">copd</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `cohort_definition_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `subject_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bind.html">bind</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">asthma</span>, </span>
<span>            <span class="va">cdm</span><span class="op">$</span><span class="va">copd</span>,</span>
<span>            name <span class="op">=</span> <span class="st">"exposures"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: <span style="color: #BBBB00;">!</span> 1 column in <span style="font-weight: bold;">exposures</span> do not match expected column type:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `subject_id` observed <span style="color: #0000BB;">numeric</span> expected <span style="color: #0000BB;">integer</span></span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">exposures</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id subject_id cohort_start_date cohort_end_date</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">*</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1          1 2020-01-01        2020-01-10     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    2          2 2020-01-01        2020-01-10</span></span>
<span></span>
<span><span class="fu"><a href="../reference/settings.html">settings</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">exposures</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id cohort_name</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1 asthma     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    2 copd</span></span>
<span><span class="fu"><a href="../reference/attrition.html">attrition</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">exposures</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects reason_id reason          </span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              1               1         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    2              1               1         1 Initial qualify…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: excluded_records &lt;int&gt;, excluded_subjects &lt;int&gt;</span></span></span>
<span><span class="fu"><a href="../reference/cohortCount.html">cohortCount</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">exposures</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   cohort_definition_id number_records number_subjects</span></span>
<span><span class="co">#&gt;                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                    1              1               1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    2              1               1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="export-metadata-about-a-cohort-table">Export metadata about a cohort table<a class="anchor" aria-label="anchor" href="#export-metadata-about-a-cohort-table"></a>
</h2>
<p>You can export the metadata of a <code>cohort_table</code> using the
function: <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">$</span><span class="va">exposures</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 12</span></span>
<span><span class="co">#&gt; Columns: 13</span></span>
<span><span class="co">#&gt; $ result_id        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4</span></span>
<span><span class="co">#&gt; $ cdm_name         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "example_cdm", "example_cdm", "example_cdm", "example…</span></span>
<span><span class="co">#&gt; $ group_name       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "cohort_name", "cohort_name", "cohort_name", "cohort_…</span></span>
<span><span class="co">#&gt; $ group_level      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "asthma", "asthma", "copd", "copd", "asthma", "asthma…</span></span>
<span><span class="co">#&gt; $ strata_name      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "overall", "overall", "overall", "overall", "reason",…</span></span>
<span><span class="co">#&gt; $ strata_level     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "overall", "overall", "overall", "overall", "Initial …</span></span>
<span><span class="co">#&gt; $ variable_name    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "number_records", "number_subjects", "number_records"…</span></span>
<span><span class="co">#&gt; $ variable_level   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA</span></span>
<span><span class="co">#&gt; $ estimate_name    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "count", "count", "count", "count", "count", "count",…</span></span>
<span><span class="co">#&gt; $ estimate_type    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "integer", "integer", "integer", "integer", "integer"…</span></span>
<span><span class="co">#&gt; $ estimate_value   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "1", "1", "1", "1", "0", "0", "1", "1", "0"…</span></span>
<span><span class="co">#&gt; $ additional_name  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "overall", "overall", "overall", "overall", "reason_i…</span></span>
<span><span class="co">#&gt; $ additional_level <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "overall", "overall", "overall", "overall", "1", "1",…</span></span></code></pre></div>
<p>This will provide a <code>summarised_result</code> object with the
metadata of the cohort (cohort set, cohort counts and cohort
attrition).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marti Catala, Edward Burn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
